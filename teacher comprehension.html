<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teacher Dashboard - Mathcloud Tutorial</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f9faff;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #004d99;
      color: white;
      text-align: center;
      padding: 1rem;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }
    details {
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 8px;
      background: white;
    }
    summary {
      font-weight: bold;
      cursor: pointer;
      color: #004d99;
    }
    .answer-block {
      margin: 6px 0;
      padding: 6px;
      border-left: 4px solid #0066cc;
      background: #f4faff;
    }
    .student-info {
      background: #eaf4ff;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .correct {
      color: green;
      font-weight: bold;
    }
    .student {
      color: darkred;
    }
    button {
      padding: 6px 12px;
      margin: 6px 0;
      border: none;
      border-radius: 6px;
      background: #0066cc;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #004d99; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“˜ Mathcloud Tutorial</h1>
    <h2>Teacher Comprehension Dashboard</h2>
  </header>

  <div class="container">
    <button onclick="loadSubmissions()">ðŸ”„ Refresh Submissions</button>
    <div id="submissions"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAFsHg9fK6IDnHbuxmBleEfIIfVGsuLDik",
      authDomain: "profile-b825d.firebaseapp.com",
      projectId: "profile-b825d",
      storageBucket: "profile-b825d.firebasestorage.app",
      messagingSenderId: "925276859161",
      appId: "1:925276859161:web:194c60f6dbd9f1ef8bf388"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Correct answers (must match student page order)
    const data = [
      {
        passage: "One sunny morning, Emma found a lost puppy near her house.",
        answers: [
          "Emma", "In the morning", "Milk", "To find its owner", "Near her house"
        ]
      },
      {
        passage: "The Nile River in Egypt is one of the longest rivers in the world.",
        answers: [
          "Egypt", "One of the longest rivers", "Helped grow crops", "Thousands of years", "Egypt"
        ]
      },
      {
        passage: "Birds migrate to warmer places during winter.",
        answers: [
          "Migrate", "Flock", "Spring", "To find warmth/food", "Spring"
        ]
      },
      {
        passage: "Thomas Edison invented the electric bulb.",
        answers: [
          "Thomas Edison", "Electric bulb", "Changed lives and work", "Thomas Edison", "Candles/lamps"
        ]
      },
      {
        passage: "The cheetah is the fastest land animal.",
        answers: [
          "Cheetah", "120 km/h", "To catch prey", "Prey", "Land animal"
        ]
      },
      {
        passage: "Mount Everest is the tallest mountain in the world.",
        answers: [
          "Tallest mountain", "Nepal/World", "Peak", "Every year", "Tallest mountain"
        ]
      },
      {
        passage: "Honeybees live in hives and make honey.",
        answers: [
          "Hives", "Honey", "Pollination", "Flowers and crops", "Hive"
        ]
      }
    ];

    async function loadSubmissions() {
      const submissionsDiv = document.getElementById("submissions");
      submissionsDiv.innerHTML = "<p>Loading...</p>";

      const q = query(collection(db, "comprehensionAnswers"), orderBy("timestamp", "desc"));
      const snapshot = await getDocs(q);

      submissionsDiv.innerHTML = "";

      snapshot.forEach(doc => {
        const dataDoc = doc.data();
        const studentBlock = document.createElement("details");
        studentBlock.innerHTML = `
          <summary>${dataDoc.name} (${dataDoc.class})</summary>
          <div class="student-info">
            Submitted: ${dataDoc.timestamp?.toDate?.().toLocaleString?.() || "Unknown"}
          </div>
          ${renderAnswers(dataDoc.answers)}
        `;
        submissionsDiv.appendChild(studentBlock);
      });
    }

    function renderAnswers(answers) {
      let html = "";
      data.forEach((p,i)=>{
        html += `<details><summary>Passage ${i+1}</summary>`;
        p.answers.forEach((ans,j)=>{
          const studentAns = answers[`Passage${i+1}_Q${j+1}`] || "(No Answer)";
          html += `
            <div class="answer-block">
              <b>Q${j+1}:</b> <span class="student">${studentAns}</span><br>
              <span class="correct">âœ” Correct: ${ans}</span>
            </div>
          `;
        });
        html += "</details>";
      });
      return html;
    }

    window.loadSubmissions = loadSubmissions;
    loadSubmissions();
  </script>
</body>
  </html>
